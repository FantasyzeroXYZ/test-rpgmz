<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RPGMZ Player (Pro) - 支持本地和在线部署</title>
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<header>
  <h3 style="margin: 0;">🎮 RPGMZ Player Pro</h3>
  <input type="file" id="zip" accept=".zip,.ZIP" />
  <div class="status-bar">
    <span id="sw-status">Service Worker: <span class="status-indicator" id="sw-indicator"></span></span>
    <span id="game-status">游戏: <span class="status-indicator" id="game-indicator"></span></span>
    <span id="env-info"></span>
  </div>
</header>

<div class="container">
  <div class="game-area">
    <iframe id="game" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
    <div id="flash"></div>
  </div>

  <div class="sidebar">
    <div class="panel">
      <h3>💬 对话文本提取</h3>
      <div class="controls-row">
        <div class="checkbox-container">
          <input type="checkbox" id="auto-sync" checked>
          <label for="auto-sync">自动同步</label>
        </div>
        <button class="secondary" onclick="extractText()" title="手动提取当前对话">
          📝 手动提取
        </button>
        <button class="secondary" onclick="clearText()" title="清空文本框">
          🗑️ 清空
        </button>
      </div>
      <textarea id="game-text" placeholder="当前没有对话..."></textarea>
    </div>

    <div class="panel">
      <h3>📷 截图功能</h3>
      <div class="controls-row">
        <button onclick="takeScreenshot()" title="截取游戏画面">
          📸 截取画面
        </button>
        <button class="secondary" onclick="downloadScreenshot()" title="下载截图" id="download-btn" disabled>
          ⬇️ 下载截图
        </button>
      </div>
      <img id="screenshot-img" />
      <p id="screenshot-tip" style="font-size:12px; color:#888; display:none; margin: 5px 0 0 0;">
        已捕获 (右键可保存)
      </p>
    </div>

    <div class="panel">
      <h3>⚙️ 调试信息</h3>
      <div id="debug-info">等待加载...</div>
    </div>

    <div id="log">等待 ZIP 文件上传...</div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="js/script.js"></script>
</body>
</html>